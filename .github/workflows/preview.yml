name: Publish Preview

on:
  pull_request:
    branches:
      - features-*
      - release-*

jobs:
  echovars:
    name: echo GA variables
    runs-on: ubuntu-latest
    steps:
    - run: echo $GITHUB_WORKFLOW
    - run: echo $GITHUB_ACTION
    - run: echo $GITHUB_ACTOR
    - run: echo $GITHUB_REPOSITORY
    - run: echo $GITHUB_EVENT_NAME
    - run: echo $GITHUB_EVENT_PATH
    - run: echo $GITHUB_WORKSPACE
    - run: echo $GITHUB_SHA
    - run: echo $GITHUB_REF
    - run: echo $GITHUB_HEAD_REF
    - run: echo $GITHUB_BASE_REF

  publish: 
    name: Publish Commit Package
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Write NPM Snapshot Version
      uses: thefrontside/actions/write-npm-snapshot-version@master
    - uses: actions/setup-node@v1
      with:
        node-version: '10.x'
    - run: echo "//registry.npmjs.org/:_authToken=${{secrets.NPM_AUTH_TOKEN}}" > ~/.npmrc
    - name: NPM Publish Commit
      run: npm publish --access=public --tag $GITHUB_HEAD_REF

  # comment: 
  #   name: Post Instruction Comment
  #   runs-on: ubuntu-latest
  #   needs: publish
  #   steps:
  #   - uses: actions/checkout@v1
  #   - name: Post Comment
  #     uses: thefrontside/actions/post-npm-usage-instructions-comment@master
  #     env: 
  #       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}