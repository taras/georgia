name: TNP Merge

on:
  push:
    branches:
      - release-*
jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
    - name:
      run: yarn test

  # publish:
  #   name: Commit & Publish
  #   runs-on: ubuntu-latest
  #   needs: tests
  #   steps:
  #   - uses: actions/checkout@v1
  #   - name: Commit & Publish
  #     run: |
  #       if [[ "$(git log -1 --pretty=%B)" =~ "[ci skip]" ]]
  #       then 
  #         echo skipping because either automated commit
  #       else
  #         git remote set-url origin https://${GITHUB_TOKEN}:x-oauth-basic@github.com/taras/georgia.git
  #         git fetch origin +refs/heads/*:refs/heads/*
  #         ref=$GITHUB_REF
  #         branch=$(printf "%s\n" "${ref#*refs\/heads\/}")
  #         git checkout $branch
  #         git config user.email "`node -e \"console.log(require('./package.json').author.email)\"`"
  #         git config user.name "`node -e \"console.log(require('./package.json').author.name)\"`"
  #         wget https://github.com/github/hub/releases/download/v2.12.3/hub-linux-amd64-2.12.3.tgz
  #         tar -zxvf hub-linux-amd64-2.12.3.tgz
  #         cd hub-linux-amd64-2.12.3
  #         sudo ./install
  #         labels=$(hub pr list -s merged -L 1 -f %L)
  #         if [[ "$labels" =~ "major" ]]
  #         then
  #           echo skipping because major label and publishing should be done manually
  #         else 
  #           cd ..
  #           if [[ "$labels" =~ "minor" ]]
  #           then
  #             npm version minor --no-git-tag-version 
  #           else
  #             npm version patch --no-git-tag-version
  #           fi
  #           git add package.json
  #           current="`node -e \"console.log(require('./package.json').version)\"`"
  #           git commit -m "Release version $current [ci skip]"
  #           git push origin HEAD
  #           echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" > ~/.npmrc
  #           npm publish --access=public
  #         fi
  #       fi
  #     env:
  #       GITHUB_TOKEN: ${{ secrets.MK_TOKEN }}
  #       NPM_AUTH_TOKEN: ${{ secrets.NPM_AUTH_TOKEN }}